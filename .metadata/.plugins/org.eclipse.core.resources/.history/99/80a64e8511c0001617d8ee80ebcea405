/**
 * 
 */
package partie;

import java.util.ArrayList;
import java.util.Random;

import joueur.Joueur;

/**
 * @author Lallement
 * La classe Tour decrit le comportement de l'ensemble des tours au sein d'une partie
 */
public class Tour implements Runnable {

	/* ---------- Attributs ---------- */
	/**
	 * Numero du tour
	 */
	private int numTour;
	
	/**
	 * Dernier tour durant lequel une carte Apocalypse a ete utilisee
	 */
	private int dernierTourApo;
	
	/**
	 * Dernier joueur ayant utilise une carte apocalypse
	 */
	private Joueur dernierJoueurApo = null;
	
	/**
	 * Dernier joueur ayant lance le De
	 */
	private Joueur dernierLanceur = null;
	
	/**
	 * Partie dans laquelle se deroule le tour
	 */
	private Partie partie;
	
	/**
	 * Thread du tour
	 */
	private Thread t;
	
	/**
	 * Joueurs ayant joue durant ce tour
	 */
	private ArrayList<Joueur> ayantJoue = new ArrayList<Joueur>();
	
	/**
	 * True : un tour est en cours
	 * False : aucun tour n'est en cours
	 */
	public static boolean enCours = false;
	
	/**
	 * Joueur devant jouer
	 */
	private Joueur joueurActuel = null;
	
	/* ---------- Constructeurs ---------- */
	/**
	 * Suppression du constructeur publique par defaut 
	 */
	private Tour() {}
	
	/**
	 * Constructeur avec argument
	 * @param {Partie} p : partie durant laquelle se deroulera le tour
	 */
	public Tour(Partie p) {
		this.partie = p;
		this.numTour = this.partie.getTours().size();
		this.partie.getTours().add(this);
	}
	
	/* ---------- Getters & Setters ---------- */
	/**
	 * Accesseur pour l'attribut numTour
	 * @return {int} numTour : numero du tour
	 */
	public int getNumTour() {
		return this.numTour;
	}

	/**
	 * Modificateur pour l'attribut numTour
	 * @param {int} numTour : numero a attribuer au tour
	 */
	public void setNumTour(int numTour) {
		this.numTour = numTour;
	}

	/**
	 * Accesseur pour l'attribut dernierTourApo
	 * @return {int} dernierTourApo : numero du dernier tour durant lequel a ete utilise une carte apocalypse
	 */
	public int getDernierTourApo() {
		return this.dernierTourApo;
	}

	/**
	 * Modificateur pour l'attribut dernierTourApo
	 * @param {int} dernierTourApo : numero a attribuer au dernier tour durant lequel a ete utilisee une carte apocalypse
	 */
	public void setDernierTourApo(int dernierTourApo) {
		this.dernierTourApo = dernierTourApo;
	}

	/**
	 * Accesseur pour l'attribut dernierJoueurApo
	 * @return {Joueur} dernierJoueurApo : dernier joueur ayant utilise une carte apocalypse
	 */
	public Joueur getDernierJoueurApo() {
		return this.dernierJoueurApo;
	}

	/**
	 * Modificateur pour l'attribut dernierJoueurApo
	 * @param {Joueur} dernierJoueurApo : dernier joueur ayant utilise une carte apocalypse
	 */
	public void setDernierJoueurApo(Joueur dernierJoueurApo) {
		this.dernierJoueurApo = dernierJoueurApo;
	}

	/**
	 * Accesseur pour l'attribut dernierLanceur
	 * @return {Joueur} dernierLanceur : dernier joueur ayant lance le de
	 */
	public Joueur getDernierLanceur() {
		return this.dernierLanceur;
	}

	/**
	 * Modificateur pour l'attribut dernierLanceur
	 * @param {Joueur} dernierLanceur : dernier joueur ayant lance le de
	 */
	public void setDernierLanceur(Joueur dernierLanceur) {
		this.dernierLanceur = dernierLanceur;
	}

	/**
	 * Accesseur pour l'attribut partie
	 * @return {Partie} partie : partie durant laquelle se deroule le tour
	 */
	public Partie getPartie() {
		return this.partie;
	}

	/**
	 * Modificateur pour l'attribut partie
	 * @param {Partie} partie : partie durant laquelle le tour doit se derouler
	 */
	public void setPartie(Partie partie) {
		this.partie = partie;
		this.partie.getTours().add(this);
	}

	/**
	 * Accesseur pour l'attribut ayantJoue
	 * @return {ArrayList<Joueur>} ayantJoue : ArrayList contenant les joueurs ayant fini de joue ce tour
	 */
	public ArrayList<Joueur> getAyantJoue() {
		return this.ayantJoue;
	}

	/**
	 * Accesseur pour l'attribut JoueurActuel
	 * @return {Joueur} joueurActuel : joueur en train de jouer 
	 */
	public Joueur getJoueurActuel() {
		return this.joueurActuel;
	}

	/**
	 * Modificateur pour l'attribut JoueurActuel
	 * @param {Joueur} joueurActuel : joueur dont le tour est venu de jouer
	 */
	public void setJoueurActuel(Joueur joueurActuel) {
		this.joueurActuel = joueurActuel;
	}

	/* ---------- Méthodes ---------- */
	/**
	 * Methode permettant de lancer un tour
	 */
	public void lancerTour() {
		this.t = new Thread(this);
		Tour.enCours = true;
		this.t.start();
	}
	
	/**
	 * Implémentation de la méthode run
	 * @see Runnable#run()
	 */
	@Override
	public void run() {
		System.out.println("Tour numero: " + this.numTour + "lance");
		while (this.ayantJoue.size() != this.partie.getParticipants().size()) {
			this.determinerJoueur();
			// TODO decrire l'enchaînement des joueurs
		}
		Tour.enCours = false;
		this.t.interrupt();
	}
	
	/**
	 * Methode permettant de determiner le joueur devant effectuer sa phase de jeu
	 * @return {Joueur} joueurActuel : joueur dont le tour est venu de jouer
	 */
	private Joueur determinerJoueur() {
		if (this.partie.getTours().get(0).getJoueurActuel() == null) {
			this.joueurActuel = this.partie.getRandomJoueur();
		} else if(this.partie.getTours().indexOf(this.partie.getTourPrecedent()) == this.dernierTourApo && this.joueurActuel == null) {
			this.joueurActuel = this.dernierJoueurApo;
		}
		return this.joueurActuel;
	}
	
	/**
	 * Methode permettant de determiner si un joueur a joue durant le tour  
	 * @param {Joueur} j : joueur ayant fini de jouer pour ce tour
	 */
	public void addAyantJoue(Joueur j) {
		this.ayantJoue.add(j);
	}
	
	/**
	 * @param args
	 */
	public static void main(String[] args) {
		// TODO Auto-generated method stub

	}
}
